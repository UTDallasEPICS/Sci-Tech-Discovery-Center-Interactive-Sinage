import RPi.GPIO as GPIO # Import Library with functions to control GPIO pins of Raspberry Pi
from pn532 import * # Import driver for PN532

if name == 'main':
    try:
        pn532 = PN532_SPI(debug=False, reset=20, cs=4)

        ic, ver, rev, support = pn532.get_firmware_version()
        print('Found PN532 with firmware version: {0}.{1}'.format(ver, rev))

        # Configure PN532 to communicate with MiFare cards
        pn532.SAM_configuration()

        print('Waiting for RFID/NFC card...')
        final_val = 0 # Initialize variable to hold combined UID value
        while True:
            # Check if a card is available to read
            uid = pn532.read_passive_target(timeout=0.5)
            print('.', end="")
            # Try again if no card is available.
            if uid is None:
                continue
            print('Found card with UID:', [i for i in uid])
            
            final_val = 0;
            # Combine the UID bytes into a single integer value
            for i in range(len(uid)):
                uint = uid[i] % (1<<32) # Ensures value is 32-bit unsigned integer
                uint = uint << 8*(3 -i) # Shifts bits to correct position
                #print('{:032b}'.format(uint)) 
                final_val = uint | final_val # Combines all bytes into final_val
                print(f"UID Converted to Unsigned 32-Bit decimal: {final_val}") # Prints final_val in decimal form
                break
    except Exception as e:
            print(f"\nAn error occured: {e}")
    finally:
            print("\nCleaning up GPIO...")
            GPIO.cleanup()
